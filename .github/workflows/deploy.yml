name: Deploy to Cloudflare Pages

on:
  push:
      branches:
            - master

            jobs:
              deploy:
                  runs-on: ubuntu-latest
                      name: Deploy
                          permissions:
                                contents: read
                                      deployments: write
                                          steps:
                                                - name: Checkout
                                                        uses: actions/checkout@v4

                                                              - name: Setup Node.js
                                                                      uses: actions/setup-node@v4
                                                                              with:
                                                                                        node-version: '20'
                                                                                                  cache: 'npm'

                                                                                                        - name: Install dependencies
                                                                                                                run: npm ci
                                                                                                                
                                                                                                                      - name: Build with next-on-pages
                                                                                                                              run: npx @cloudflare/next-on-pages
                                                                                                                                      env:
                                                                                                                                                NODE_ENV: production
                                                                                                                                                
                                                                                                                                                      - name: Deploy to Cloudflare Pages
                                                                                                                                                              uses: cloudflare/wrangler-action@v3
                                                                                                                                                                      with:
                                                                                                                                                                                apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
                                                                                                                                                                                          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
                                                                                                                                                                                                    command: pages deploy .vercel/output/static --project-name=node-banana
                                                                                                                                                                                                              gitHubToken: ${{ secrets.GITHUB_TOKEN }}
